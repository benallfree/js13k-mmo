import e from"https://js13kgames.com/2025/online/partysocket.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),window.PartySocket=e;let t,s,n,o,i,r,l=Object.getPrototypeOf,a={isConnected:1},d={},c=l(a),w=l(l),f=(e,t,s,n)=>(e??(setTimeout(s,n),new Set)).add(t),m=(e,t,s)=>{let o=n;n=t;try{return e(s)}catch(i){return s}finally{n=o}},u=e=>e.filter(e=>e._dom?.isConnected),g=e=>i=f(i,e,()=>{for(let e of i)e._bindings=u(e._bindings),e._listeners=u(e._listeners);i=r},1e3),_={get val(){return n?._getters?.add(this),this.rawVal},get oldVal(){return n?._getters?.add(this),this._oldVal},set val(e){n?._setters?.add(this),e!==this.rawVal&&(this.rawVal=e,this._bindings.length+this._listeners.length?(s?.add(this),t=f(t,this,S)):this._oldVal=e)}},h=e=>({__proto__:_,rawVal:e,_oldVal:e,_bindings:[],_listeners:[]}),p=(e,t)=>{let s={_getters:new Set,_setters:new Set},n={f:e},i=o;o=[];let r=m(e,s,t);r=(r??document).nodeType?r:new Text(r);for(let o of s._getters)s._setters.has(o)||(g(o),o._bindings.push(n));for(let l of o)l._dom=r;return o=i,n._dom=r},v=(e,t=h(),s)=>{let n={_getters:new Set,_setters:new Set},i={f:e,s:t};i._dom=s??o?.push(i)??a,t.val=m(e,n,t.rawVal);for(let o of n._getters)n._setters.has(o)||(g(o),o._listeners.push(i));return t},y=(e,...t)=>{for(let s of t.flat(1/0)){let t=l(s??0),n=t===_?p(()=>s.val):t===w?p(s):s;n!=r&&e.append(n)}return e},b=(e,t,...s)=>{let[{is:n,...o},...i]=l(s[0]??0)===c?s:[{},...s],a=e?document.createElementNS(e,t,{is:n}):document.createElement(t,{is:n});for(let[c,f]of Object.entries(o)){let e=t=>t?Object.getOwnPropertyDescriptor(t,c)??e(l(t)):r,s=t+","+c,n=d[s]??=e(l(a))?.set??0,o=c.startsWith("on")?(e,t)=>{let s=c.slice(2);a.removeEventListener(s,t),a.addEventListener(s,e)}:n?n.bind(a):a.setAttribute.bind(a,c),i=l(f??0);c.startsWith("on")||i===w&&(f=v(f),i=_),i===_?p(()=>(o(f.val,f._oldVal),a)):o(f)}return y(a,i)},k=e=>({get:(t,s)=>b.bind(r,e,s)}),V=(e,t)=>t?t!==e&&e.replaceWith(t):e.remove(),S=()=>{let e=0,n=[...t].filter(e=>e.rawVal!==e._oldVal);do{s=new Set;for(let e of new Set(n.flatMap(e=>e._listeners=u(e._listeners))))v(e.f,e.s,e._dom),e._dom=r}while(++e<100&&(n=[...s]).length);let o=[...t].filter(e=>e.rawVal!==e._oldVal);t=r;for(let t of new Set(o.flatMap(e=>e._bindings=u(e._bindings))))V(t._dom,p(t.f,t._dom)),t._dom=r;for(let t of o)t._oldVal=t.rawVal};const L={tags:new Proxy(e=>new Proxy(b,k(e)),k()),hydrate:(e,t)=>V(e,p(t,e)),add:y,state:h,derive:v},P=(e,t,s=window.socket)=>{s.addEventListener("message",s=>{const n=s.data.toString();n.startsWith(e)&&t(n.slice(e.length))})},E=e=>`_${e}`;function O(e,t="var(--ok)"){C.val={dot:t,message:e}}window.socket=new window.PartySocket({host:"relay.js13kgames.com",party:"mewsterpiece",room:"presence"}),((e,t=window.socket)=>{P("+",e,t)})(e=>{j.val=[...j.val.filter(t=>t!==e),e],$&&((e,t,s=window.socket)=>{((e,t,s,n=window.socket)=>{((e,t,s=window.socket)=>{((e,t=window.socket)=>{t.send(e)})(`@${e}|${t}`,s)})(e,`${t}${s}`,n)})(e,E("i"),t,s)})(e,$)}),((e,t=window.socket)=>{P("-",e,t)})(e=>{j.val=j.val.filter(t=>t!==e)}),((e,t=window.socket)=>{P(E("i"),e,t)})(e=>{j.val=[...j.val.filter(t=>t!==e),e]});let $=null;((e,t=window.socket)=>{P("@",e,t)})(e=>{O(`id: ${e}`),$=e}),((e,t=window.socket)=>{t.addEventListener("open",e)})(()=>O("Connected","var(--ok)")),((e,t=window.socket)=>{t.addEventListener("close",e)})(()=>O("Disconnected","var(--bad)"));const j=L.state([]),C=L.state({dot:"var(--warn)",message:"Connectingâ€¦"}),{div:W,main:x,span:N,h1:T,p:D}=L.tags;L.add(document.getElementById("app"),x({class:"wrap"},T("Presence Demo"),W({class:"status",role:"status","aria-live":"polite"},()=>N({id:"status-dot","aria-hidden":"true",style:`background: ${C.val.dot}`}),()=>N({id:"status-text"},C.val.message)),D('This demo shows how to register an active player with Lab 13 using minimal code. Opening this page establishes a WebSocket connection and registers your presence in the "presence" room.'),D({class:"muted"},"Keep this tab open to remain online."),W({class:"client-ids-section"},N({class:"client-ids-title"},"Client Ids"),()=>W({id:"client-ids",class:"client-ids-list"},...j.val.map(e=>W({class:"client-id-item"},e))))));
