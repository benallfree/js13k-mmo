import z from"https://js13kgames.com/2025/online/partysocket.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();window.PartySocket=z;let l=Object.getPrototypeOf,h,P,f,g,N={isConnected:1},H=1e3,_,Q={},X=l(N),W=l(l),d,x=(e,t,n,s)=>(e??(setTimeout(n,s),new Set)).add(t),K=(e,t,n)=>{let s=f;f=t;try{return e(n)}catch(o){return console.error(o),n}finally{f=s}},y=e=>e.filter(t=>t._dom?.isConnected),F=e=>_=x(_,e,()=>{for(let t of _)t._bindings=y(t._bindings),t._listeners=y(t._listeners);_=d},H),b={get val(){return f?._getters?.add(this),this.rawVal},get oldVal(){return f?._getters?.add(this),this._oldVal},set val(e){f?._setters?.add(this),e!==this.rawVal&&(this.rawVal=e,this._bindings.length+this._listeners.length?(P?.add(this),h=x(h,this,Y)):this._oldVal=e)}},G=e=>({__proto__:b,rawVal:e,_oldVal:e,_bindings:[],_listeners:[]}),m=(e,t)=>{let n={_getters:new Set,_setters:new Set},s={f:e},o=g;g=[];let r=K(e,n,t);r=(r??document).nodeType?r:new Text(r);for(let i of n._getters)n._setters.has(i)||(F(i),i._bindings.push(s));for(let i of g)i._dom=r;return g=o,s._dom=r},L=(e,t=G(),n)=>{let s={_getters:new Set,_setters:new Set},o={f:e,s:t};o._dom=n??g?.push(o)??N,t.val=K(e,s,t.rawVal);for(let r of s._getters)s._setters.has(r)||(F(r),r._listeners.push(o));return t},I=(e,...t)=>{for(let n of t.flat(1/0)){let s=l(n??0),o=s===b?m(()=>n.val):s===W?m(n):n;o!=d&&e.append(o)}return e},q=(e,t,...n)=>{let[{is:s,...o},...r]=l(n[0]??0)===X?n:[{},...n],i=e?document.createElementNS(e,t,{is:s}):document.createElement(t,{is:s});for(let[p,u]of Object.entries(o)){let D=w=>w?Object.getOwnPropertyDescriptor(w,p)??D(l(w)):d,R=t+","+p,E=Q[R]??=D(l(i))?.set??0,T=p.startsWith("on")?(w,U)=>{let M=p.slice(2);i.removeEventListener(M,U),i.addEventListener(M,w)}:E?E.bind(i):i.setAttribute.bind(i,p),k=l(u??0);p.startsWith("on")||k===W&&(u=L(u),k=b),k===b?m(()=>(T(u.val,u._oldVal),i)):T(u)}return I(i,r)},A=e=>({get:(t,n)=>q.bind(d,e,n)}),B=(e,t)=>t?t!==e&&e.replaceWith(t):e.remove(),Y=()=>{let e=0,t=[...h].filter(s=>s.rawVal!==s._oldVal);do{P=new Set;for(let s of new Set(t.flatMap(o=>o._listeners=y(o._listeners))))L(s.f,s.s,s._dom),s._dom=d}while(++e<100&&(t=[...P]).length);let n=[...h].filter(s=>s.rawVal!==s._oldVal);h=d;for(let s of new Set(n.flatMap(o=>o._bindings=y(o._bindings))))B(s._dom,m(s.f,s._dom)),s._dom=d;for(let s of n)s._oldVal=s.rawVal};const S={tags:new Proxy(e=>new Proxy(q,A(e)),A()),hydrate:(e,t)=>B(e,m(t,e)),add:I,state:G,derive:L},Z=(e,t=window.socket)=>{t.addEventListener("open",e)},ee=(e,t=window.socket)=>{t.addEventListener("close",e)},C=(e,t,n=window.socket)=>{n.addEventListener("message",s=>{const o=s.data.toString();o.startsWith(e)&&t(o.slice(e.length))})},te=(e,t=window.socket)=>{t.send(e)},se=(e,t,n=window.socket)=>{te(`@${e}|${t}`,n)},oe=(e,t,n,s=window.socket)=>{se(e,`${t}${n}`,s)},ne=(e,t=window.socket)=>{C("+",e,t)},re=(e,t=window.socket)=>{C("-",e,t)},ie=(e,t=window.socket)=>{C("@",e,t)},J=e=>`_${e}`,le=(e,t,n=window.socket)=>{oe(e,J("i"),t,n)},ae=(e,t=window.socket)=>{C(J("i"),e,t)};function $(e,t="var(--ok)"){console.log(`[${a}] setStatus`,e,t),V.val={dot:t,message:e}}window.socket=new window.PartySocket({host:"relay.js13kgames.com",party:"mewsterpiece",room:"presence"});ne(e=>{console.log(`[${a}] client joined`,e),c.val=[...c.val.filter(t=>t!==e),e],a&&le(e,a)});re(e=>{console.log(`[${a}] client left`,e),c.val=c.val.filter(t=>t!==e)});ae(e=>{console.log(`[${a}] ident received from`,e),c.val=[...c.val.filter(t=>t!==e),e]});let a=null;ie(e=>{console.log(`[${a}] player id updated`,e),$(`id: ${e}`),a=e});Z(()=>$("Connected","var(--ok)"));ee(()=>$("Disconnected","var(--bad)"));const c=S.state([]),V=S.state({dot:"var(--warn)",message:"Connectingâ€¦"}),{div:v,main:de,span:O,h1:ce,p:j}=S.tags,pe=()=>de({class:"wrap"},ce("Presence Demo"),v({class:"status",role:"status","aria-live":"polite"},()=>O({id:"status-dot","aria-hidden":"true",style:`background: ${V.val.dot}`}),()=>O({id:"status-text"},V.val.message)),j('This demo shows how to register an active player with Lab 13 using minimal code. Opening this page establishes a WebSocket connection and registers your presence in the "presence" room.'),j({class:"muted"},"Keep this tab open to remain online."),v({class:"client-ids-section"},O({class:"client-ids-title"},"Client Ids"),()=>v({id:"client-ids",class:"client-ids-list"},...c.val.map(e=>v({class:"client-id-item"},e)))));S.add(document.getElementById("app"),pe());
