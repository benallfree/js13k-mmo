import{PartySocket as O}from"https://js13kgames.com/2025/online/partysocket.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();window.PartySocket=O;const d=[{name:"Tilly",ttl:3e5,path:"M90 50 C75 35 105 35 90 20 M75 35 L60 20 M105 35 L120 20 M70 50 C50 70 50 90 70 110 C80 120 100 120 110 110 C130 90 130 70 110 50 M70 110 L60 140 M80 110 L70 140 M100 110 L90 140 M110 110 L100 140 M110 110 C130 130 150 150 170 130 M85 45 C85 45 85 50 85 50 M95 45 C95 45 95 50 95 50 M90 50 L90 60 M85 60 L65 60 M95 60 L115 60",width:120,height:130,bounds:{minX:50,minY:20,maxX:170,maxY:150}},{name:"Whiskers",ttl:24e4,path:"M100 30 C85 15 115 15 100 0 M85 15 L70 0 M115 15 L130 0 M80 30 C60 50 60 80 80 100 C90 120 110 120 120 100 C140 80 140 50 120 30 M80 100 L70 140 M90 100 L80 140 M110 100 L100 140 M120 100 L110 140 M100 100 C120 120 140 140 160 120 M90 25 C90 25 90 30 90 30 M110 25 C110 25 110 30 110 30 M100 30 L100 40 M90 40 L70 40 M110 40 L130 40",width:100,height:140,bounds:{minX:60,minY:0,maxX:160,maxY:140}},{name:"Shadow",ttl:21e4,path:"M100 40 C80 20 120 20 100 0 M80 20 L60 0 M120 20 L140 0 M80 40 C60 60 60 100 80 120 C80 140 120 140 120 120 C140 100 140 60 120 40 M80 120 L70 160 M90 120 L80 160 M110 120 L100 160 M120 120 L110 160 M100 120 C80 140 60 160 40 140 M90 30 C90 30 90 35 90 35 M110 30 C110 30 110 35 110 35 M100 35 L100 45 M90 45 L70 45 M110 45 L130 45",width:100,height:160,bounds:{minX:40,minY:0,maxX:140,maxY:160}},{name:"Luna",ttl:18e4,path:"M70 46a24 24 0 1 1 0 48 24 24 0 1 1 0-48M54 58 44 40l20 10Zm32 0 10-18-20 10ZM62 70h4m12 0h4m-14 8 2 2 2-2m-2 2v5m0 0c-4 3-8 3-10 0m10 0c4 3 8 3 10 0M52 74l-22-4m22 8H30m22 4-22 4m58-12 22-4m-22 8h22m-22 4 22 4m-20 14c30 10 50 40 40 70-10 20-50 22-70 0-8-10-6-22 4-30m6-42c8 12 8 32 2 52m0 0 10 20 10-20m28 0c30 0 40-30 20-40-10-4-18 2-16 12 2 14 22 18 32 8",width:130,height:152,bounds:{minX:30,minY:40,maxX:160,maxY:192}},{name:"Mittens",ttl:15e4,path:"m90 60 10-20 10 20c20 2 30 20 30 38 2 32-12 62-40 70s-52-12-50-36c2-22 20-34 34-34-14-8-18-20-14-30m14 18h6m18 0h6M96 96l2 2 2-2m-2 2v4m0 0c-4 2-8 2-10 0m10 0c4 2 8 2 10 0M76 92l-20-2m20 6H56m20 4-20 2m48-10 20-2m-20 6h20m-20 4 20 2m-4 48c40 0 44-32 20-38-8 0-10 8-4 12 10 8 20 2 24-6",width:116,height:136,bounds:{minX:48,minY:40,maxX:164,maxY:176}},{name:"Pumpkin",ttl:12e4,path:"m80 60 10-20 10 20c12 2 18 12 18 24 0 16-14 28-28 28s-28-12-28-28c0-12 6-22 18-24m4 22h4m8 0h4m-10 6v4m0 0c-5 3-9 3-12 0m12 0c5 3 9 3 12 0m8 18c30 10 42 38 22 60-20 20-60 18-72-6-6-12 0-26 12-32m6-6v24m8 0v18m38-18c24 0 30-22 12-28-10-4-14 4-10 10 8 12 26 12 34 0",width:106,height:150,bounds:{minX:54,minY:40,maxX:160,maxY:190}},{name:"Nova",ttl:9e4,path:"m90 54 10-18 10 18c16 4 24 18 24 32 0 20-16 36-34 36s-34-16-34-36c0-14 8-28 24-32m-4 28h6m16 0h6M96 92v6m0 0c-6 4-10 4-14 0m14 0c6 4 10 4 14 0m0 20c30 10 46 38 26 58-20 18-60 16-72-8-6-12 0-28 14-34m-2-4v24m10 0v18m34-18c34 0 42-30 20-36-8 0-10 8-4 12 12 8 26 2 32-8",width:110,height:158,bounds:{minX:58,minY:36,maxX:168,maxY:194}},{name:"Cosmo",ttl:6e4,path:"m120 84 8-18 8 18c14 6 20 20 18 34-4 28-28 46-54 44s-46-24-42-48c2-14 14-24 30-26-12-6-16-18-12-28m16 40h6m16 0h6m-16 8v6m0 0c-6 4-10 4-14 0m14 0c6 4 10 4 14 0m12 26c30 0 38-24 18-30-10 0-12 8-6 12 12 8 28 4 34-6",width:122,height:104,bounds:{minX:54,minY:60,maxX:176,maxY:164}},{name:"Ziggy",ttl:3e4,path:"M60 112c4-16 18-26 36-28l10-18 10 18c16 4 24 16 22 28-2 14-16 22-32 22-14 0-30-6-38-14-2 12-8 22-16 30q-6 6-12 6m46-56h6m16 0h6m-16 8v6m0 0c-6 4-10 4-14 0m14 0c6 4 10 4 14 0m30 18c28-2 32-24 14-30-8-2-10 6-6 12 8 14 24 16 34 6",width:144,height:90,bounds:{minX:40,minY:66,maxX:184,maxY:156}},{name:"Pixel",ttl:15e3,path:"m78 70 10-18 10 18c18 2 28 16 28 30 0 20-16 36-36 36s-36-16-36-36c0-14 10-28 24-30m-6 22h6m18 0h6m-18 8v6m0 0c-6 4-10 4-14 0m14 0c6 4 10 4 14 0m4 30c24 10 38 32 26 46-16 12-44 8-54-8-6-10-2-24 10-30m36 10c30 0 36-26 18-32-10-2-12 8-6 12 12 8 28 4 36-6",width:114,height:142,bounds:{minX:54,minY:52,maxX:168,maxY:194}}],b=10*1e3,B=10*1e3,U=d.reduce((e,t)=>e+t.ttl+b,0)+B,H=(e,t=window.socket)=>{t.addEventListener("open",e)},_=(e,t=window.socket)=>{t.addEventListener("close",e)},z=(e,t=window.socket)=>{t.addEventListener("error",e)},p=(e,t,n=window.socket)=>{n.addEventListener("message",a=>{const i=a.data.toString();i.startsWith(e)&&t(i.slice(e.length))})},T=(e,t=window.socket)=>{t.send(e)},W=(e,t,n=window.socket)=>{T(`@${e}|${t}`,n)},P=(e,t,n,a=window.socket)=>{W(e,`${t}${n}`,a)},j=(e,t,n=window.socket)=>{T(`${e}${t}`,n)},k=(e,t=window.socket)=>{p("+",e,t)},J=(e,t=window.socket)=>{p("@",e,t)},q=e=>`_${e}`,F=(e,t,n=window.socket)=>{P(e,q("i"),t,n)},V=(e=window.socket)=>{k(n=>{console.log(`[${t}] client joined`,n),t&&F(n,t,e)},e);let t=null;J(n=>{console.log(`[${t}] player id updated`,n),t=n},e)},s={currentLevel:0,timeRemaining:0,isInLevel:!1,isInPause:!1,isInMatchPause:!1,pauseTimeRemaining:0,shared:{img:"",startedAt:Date.now(),matchNumber:1},isDrawing:!1,isInitialized:!1,completedLevels:new Set};function R(){const e=Date.now(),t=s.shared.startedAt+(s.shared.matchNumber-1)*U,n=e-t;if(n<0)return{...s,currentLevel:0,timeRemaining:Math.abs(n),isInLevel:!1,isInPause:!1,isInMatchPause:!0,pauseTimeRemaining:Math.abs(n)};let a=0;for(let i=0;i<d.length;i++){const o=d[i].ttl,l=a,h=a+o,f=h,v=f+b;if(n>=l&&n<h)return{...s,currentLevel:i,timeRemaining:h-n,isInLevel:!0,isInPause:!1,isInMatchPause:!1,pauseTimeRemaining:0};if(n>=f&&n<v)return{...s,currentLevel:i,timeRemaining:0,isInLevel:!1,isInPause:!0,isInMatchPause:!1,pauseTimeRemaining:v-n};a+=o+b}return s.shared.matchNumber++,{...s,currentLevel:0,timeRemaining:d[0].ttl,isInLevel:!0,isInPause:!1,isInMatchPause:!1,pauseTimeRemaining:0}}window.socket=new window.PartySocket({host:"relay.js13kgames.com",party:"mewsterpiece",room:"mewsterpiece"});V();const Z=e=>{const t=r.toDataURL("image/webp");console.log("Sending state to client",e,"canvas data length:",t.length),P(e,"s",JSON.stringify({...s.shared,img:t}))},G=e=>{p("s",e)};G(e=>{s.shared=JSON.parse(e);const t=R();s.currentLevel=t.currentLevel;const n=new Image;n.onload=()=>{console.log("Image loaded successfully, drawing to canvas"),c.drawImage(n,0,0)},n.onerror=a=>{console.error("Failed to load image:",a)},n.src=s.shared.img,console.log("Set image src, length:",s.shared.img?s.shared.img.length:"null/undefined")});k(e=>{console.log("Client joined:",e),Z(e)});const K=e=>{p("p",e)};K(e=>{const[t,n,a,i]=e.split("|");x(Number(t),Number(n),a,Number(i))});const Y=(e,t,n,a)=>{j("p",`${e}|${t}|${n}|${a}`)},r=document.getElementById("canvas"),c=r.getContext("2d"),M=document.getElementById("colorPicker"),y=document.getElementById("radiusSlider"),L=document.getElementById("radiusValue"),u=document.getElementById("statusIndicator"),w=document.getElementById("statusText"),C=document.getElementById("timerDisplay"),X=document.getElementById("levelDisplay"),I=document.getElementById("catThumbnails");c.imageSmoothingEnabled=!1;function S(){const e=m*2,t=M.value,n=document.createElement("canvas");n.width=e,n.height=e;const a=n.getContext("2d");a.beginPath(),a.arc(e/2,e/2,m,0,Math.PI*2),a.strokeStyle=t,a.lineWidth=1,a.stroke(),a.globalAlpha=.3,a.fillStyle=t,a.fill();const i=n.toDataURL();r.style.cursor=`url(${i}) ${e/2} ${e/2}, crosshair`}let m=Number(y?.value??5);L&&(L.textContent=String(m));y?.addEventListener("input",()=>{m=Number(y.value),L&&(L.textContent=String(m)),S()});M?.addEventListener("input",()=>{S()});S();function N(e){const t=r.getBoundingClientRect();return{x:Math.floor(e.clientX-t.left),y:Math.floor(e.clientY-t.top)}}function x(e,t,n,a=m){c.fillStyle=n,c.beginPath(),c.arc(e+.5,t+.5,a,0,Math.PI*2),c.fill()}function Q(e,t){const n=document.createElement("div");n.className="cat-thumbnail",n.dataset.level=String(t);const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("viewBox","0 0 200 200"),a.setAttribute("width","100%"),a.setAttribute("height","100%");const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",e.path),i.setAttribute("fill","none"),i.setAttribute("stroke","#374151"),i.setAttribute("stroke-width","3"),i.setAttribute("stroke-linecap","round"),i.setAttribute("stroke-linejoin","round"),a.appendChild(i);const o=document.createElement("div");if(o.className="level-number",o.textContent=String(t+1),n.appendChild(a),n.appendChild(o),t>s.currentLevel){n.classList.add("locked");const l=document.createElement("div");l.className="lock-icon",l.innerHTML="ðŸ”’",n.appendChild(l)}return n.addEventListener("click",()=>{t<=s.currentLevel&&E(t)}),n}function $(){I.innerHTML="",d.forEach((e,t)=>{const n=Q(e,t);t===s.currentLevel?n.classList.add("current"):s.completedLevels.has(t)&&n.classList.add("completed"),I.appendChild(n)})}function ee(e){const t=Math.floor(e/6e4),n=Math.floor(e%6e4/1e3);return`${t}:${n.toString().padStart(2,"0")}`}function E(e){s.currentLevel=e;const t=d[e];c.clearRect(0,0,r.width,r.height),D(e),X.textContent=`Level ${e+1}: ${t.name}`,$()}function A(){const e=R();if(e.currentLevel!==s.currentLevel){s.currentLevel=e.currentLevel;const t=d[s.currentLevel];c.clearRect(0,0,r.width,r.height),D(s.currentLevel),X.textContent=`Level ${s.currentLevel+1}: ${t.name}`,$()}e.isInLevel?(s.timeRemaining=e.timeRemaining,C.textContent=ee(s.timeRemaining)):e.isInPause?C.textContent=`Next level in ${Math.ceil(e.pauseTimeRemaining/1e3)}...`:e.isInMatchPause&&(C.textContent=`Next match in ${Math.ceil(e.pauseTimeRemaining/1e3)}...`),requestAnimationFrame(A)}function te(){s.completedLevels.add(s.currentLevel),s.currentLevel<d.length-1?(s.currentLevel++,E(s.currentLevel)):alert("Congratulations! You've completed all the cats!")}function D(e){console.log("Rendering base image for level",e,"- single player mode");const t=d[e];c.clearRect(0,0,r.width,r.height);const n=t.bounds.maxX-t.bounds.minX,a=t.bounds.maxY-t.bounds.minY,i=r.width/n,o=r.height/a,l=Math.min(i,o)*.8,h=(r.width-n*l)/2-t.bounds.minX*l,f=(r.height-a*l)/2-t.bounds.minY*l;c.save(),c.translate(h,f),c.scale(l,l);const v=new Path2D(t.path);c.strokeStyle="#374151",c.lineWidth=3/l,c.lineCap="round",c.lineJoin="round",c.stroke(v),c.restore()}function ne(){s.isInitialized=!0}function g(e,t){if(!(!u||!w)){switch(u.classList.remove("searching","connected"),u.classList.add(e),e){case"searching":w.textContent="Searching for other players...";break;case"connected":w.textContent="Connected";break}u.classList.remove("hidden")}}r.addEventListener("mousedown",e=>{if(!s.isInitialized)return;s.isDrawing=!0;const t=N(e),n=M.value;x(t.x,t.y,n,m),Y(t.x,t.y,n,m)});r.addEventListener("mousemove",e=>{if(!s.isInitialized)return;const t=N(e);if(s.isDrawing){const n=M.value;x(t.x,t.y,n,m),Y(t.x,t.y,n,m)}});r.addEventListener("mouseup",()=>{s.isDrawing=!1});r.addEventListener("mouseleave",()=>{s.isDrawing=!1});document.addEventListener("keydown",e=>{e.key==="Enter"&&te()});H(()=>{console.log("WebSocket connected"),g("connected"),ne()});_(()=>{g("searching")});z(()=>{g("searching")});g("searching");setTimeout(()=>{u&&u.classList.contains("searching")&&g("searching")},5e3);s.currentLevel=0;E(s.currentLevel);A();
