import{PartySocket as t}from"https://js13kgames.com/2025/online/partysocket.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}(),window.PartySocket=t;const e=(t,e,n=window.socket)=>{n.addEventListener("message",n=>{const o=n.data.toString();o.startsWith(t)&&e(o.slice(t.length))})},n=(t,e=window.socket)=>{e.send(t)},o=(t,n=window.socket)=>{e("+",t,n)},a=(t,n=window.socket)=>{e("-",t,n)},i=t=>`_${t}`,r="@",l=`${r}players`,s=new Set;function c(t,e,n=!1,o){const a={},i=e=>{n?delete t[e]:t[e]=null,a[e]=null,o?.startsWith(r)&&s.add(e)};return Object.keys(e).forEach(l=>{if((t=>o?.startsWith(r)&&s.has(t))(l))return void i(l);const d=e[l],h=t[l];if(null===d)i(l);else if(d&&"object"==typeof d&&!Array.isArray(d)&&h&&"object"==typeof h&&!Array.isArray(h)){const t=c(h,d,n,l);Object.keys(t).length>0&&(a[l]=t)}else d!==h&&(t[l]=d,a[l]=d)}),a}const d=t=>JSON.parse(JSON.stringify(t)),h=t=>{const{socket:n=window.socket}=t||{};let o=n.id;return((t,n=window.socket)=>{e("@",t,n)})(t=>{o=t},n),{getMyId:()=>o}},y=t=>{if("object"!=typeof t||null===t)return t;const e={...t};return Object.keys(e).forEach(t=>{t.startsWith("_")?delete e[t]:"object"==typeof e[t]&&null!==e[t]&&(e[t]=y(e[t]))}),e},f=`${r}mice`;(()=>{const t="mewsterpiece/cats".split("/"),{host:e="relay.js13kgames.com",global:n=!0}={},o=new window.PartySocket({host:e,party:t[0],room:t.join("/")});n&&(window.socket=o)})();const{getMyId:u}=h(),g=((t=0)=>(t=>{const e=(n,o=[])=>{if("object"!=typeof n||null===n)return n;for(const a in n){if(!Object.prototype.hasOwnProperty.call(n,a))continue;const i=n[a];"object"==typeof i&&null!==i?e(i,[...o,a]):n[a]=t(0,a,i)}return n};return e})((e,n,o)=>["x","y","z"].includes(n)?((t,e=0)=>0===e?Math.round(t):Math.round(t*Math.pow(10,e))/Math.pow(10,e))(o,t):o))(),{getState:m,getMyState:p,updateMyState:w,updateState:b}=(t=>{const{onBeforeSendState:r=t=>t,onStateReceived:s=(t,e)=>e,onDeltaReceived:f=t=>t,onBeforeSendDelta:u=t=>t,socket:g=window.socket,deltaThrottleMs:m=50}=t||{};let p={[l]:{}};o(t=>{w(t)},g),a(t=>{x(t,null)},g);const w=t=>{const e=r(d(p)),o=y(e);((t,e,o,a=window.socket)=>{((t,e,o=window.socket)=>{n(`@${t}|${e}`,o)})(t,`${e}${o}`,a)})(t,i("s"),JSON.stringify(o),g)};let b=null,v={};const S=(t=window.socket)=>{if(0===Object.keys(v).length||b)return;const e=u(d(v)),o=y(e);((t,e,o=window.socket)=>{n(`${t}${e}`,o)})(i("d"),JSON.stringify(o),t),v={},b=setTimeout(()=>{b=null,S(t)},m)},{getMyId:M}=h({socket:g});((t,n=window.socket)=>{e(i("s"),e=>{const n=JSON.parse(e);t(n)},n)})(t=>{const e=s(p,t),n=k(!0);p=e,P({[l]:{[M()]:n}})},g),((t,n=window.socket)=>{e(i("d"),e=>{const n=JSON.parse(e);t(n)},n)})(t=>{const e=f(t);P(e,!1)},g);const k=(t=!1)=>((t,e=!1)=>{const n=p[l]?.[t]||{};return e?d(n):n})(M(),t),x=(t,e)=>{P({[l]:{[t]:e}})},P=(t,e=!0)=>{const n=c(p,t,!0);e&&(Object.keys(n).length,c(v,n),Object.keys(v).length,S(g))};return{getState:(t=!1)=>t?d(p):p,getMyState:k,updateMyState:t=>{const e=M();x(e,t)},updatePlayerState:x,updateState:P}})({onBeforeSendState:t=>g(t),onBeforeSendDelta:t=>g(t)}),v=document.createElement("div");v.className="status-indicator status-connecting",v.textContent="Connecting...",document.body.appendChild(v);const S=document.createElement("div");S.className="score",S.textContent="Mice Caught: 0";const M=document.querySelector(".controls");M?M.appendChild(S):document.body.appendChild(S);let k={ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1},x=0;const P=document.getElementById("gameCanvas"),C=P.getContext("2d"),O=document.createElement("button");O.className="control-btn",O.textContent="Help",O.setAttribute("aria-expanded","false");const E=document.querySelector(".controls");E&&E.appendChild(O);const I=document.createElement("div");I.className="help-overlay",I.innerHTML="\n  <div><strong>üê± Black Cats Chase MMO Mice! üê≠</strong></div>\n  <div>Arrow keys to move your cat</div>\n  <div>Catch the gray mice to score points</div>\n  <div>Mice are shared across all players</div>\n  <div>Each player gets a unique black cat</div>\n  <div>Your cat label shows your name</div>\n";const A=document.querySelector(".game-container");A&&A.appendChild(I);let j=!1;function L(){P.width=800,P.height=600}function N(t,e,n=!1,o,a){if(C.save(),C.translate(t,e),C.fillStyle="#000000",C.beginPath(),C.ellipse(0,0,12,8,0,0,2*Math.PI),C.fill(),C.beginPath(),C.arc(0,-8,8,0,2*Math.PI),C.fill(),C.beginPath(),C.moveTo(-6,-14),C.lineTo(-2,-8),C.lineTo(-4,-12),C.fill(),C.beginPath(),C.moveTo(6,-14),C.lineTo(2,-8),C.lineTo(4,-12),C.fill(),C.fillStyle="#00ff00",C.beginPath(),C.arc(-3,-10,2,0,2*Math.PI),C.fill(),C.beginPath(),C.arc(3,-10,2,0,2*Math.PI),C.fill(),C.strokeStyle="#000000",C.lineWidth=3,C.beginPath(),C.moveTo(12,0),C.quadraticCurveTo(20,-5,25,0),C.stroke(),C.fillStyle="#ff6b6b",C.font="12px Arial",C.textAlign="center",n){const t=a&&a.trim().length>0?`${a} (you)`:"YOU";C.fillText(t,0,-25)}else{const t=a&&a.trim().length>0?a:"Cat",e=null!=o?o:0;C.fillText(`${t} (${e})`,0,-25)}C.restore()}O.addEventListener("click",function(){j=!j,I.style.display=j?"block":"none",O.setAttribute("aria-expanded",String(j))}),L(),window.addEventListener("resize",L),((t,e=window.socket)=>{e.addEventListener("open",t)})(()=>{v.className="status-indicator status-connected",v.textContent="Connected"}),((t,e=window.socket)=>{e.addEventListener("close",t)})(()=>{v.className="status-indicator status-disconnected",v.textContent="Disconnected"});const T=["Shadow","Midnight","Luna","Raven","Onyx","Coal","Smokey","Void","Pumpkin","Salem","Jet","Licorice","Ash","Eclipse","Night","Storm","Cinder","Sable","Pepper","Ink","Charcoal","Graphite","Obsidian","Phantom","Cosmo","Misty","Twilight","Dusky","Ember","Fang","Gloom","Hallow","Hex","Jinx","Magic","Moonlight","Mystic","Noir","Poe","Shade","Silhouette","Specter","Spooky","Vesper","Wisp","Zephyr"];o(t=>{}),a(t=>{}),document.addEventListener("keydown",t=>{k.hasOwnProperty(t.key)&&(k[t.key]=!0,t.preventDefault())}),document.addEventListener("keyup",t=>{k.hasOwnProperty(t.key)&&(k[t.key]=!1,t.preventDefault())});const $=document.getElementById("name-input");$&&($.value=T[Math.floor(Math.random()*T.length)],$.addEventListener("input",t=>{const e=t.target&&"value"in t.target?`${t.target.value}`:"";w({name:e})})),(()=>{const t=document.getElementById("name-input"),e={x:P.width/2,y:P.height/2,score:0,name:t&&"value"in t&&t.value||""};w(e)})(),setInterval(()=>{const t=m();Object.keys(t[f]||{}).length<5&&function(){const t=Math.random().toString(36).substring(2,15),e={x:Math.random()*(P.width-40)+20,y:Math.random()*(P.height-40)+20,_vx:2*(Math.random()-.5),_vy:2*(Math.random()-.5),_owner:u()};b({[f]:{[t]:e}})}()},1e3),function t(){!function(){const t=m();t[f]&&Object.entries(t[f]).filter(t=>t[1]?._owner===u()).map(t=>[t[0],d(t[1])]).forEach(([t,e])=>{e.x=(e.x??0)+(e._vx??0),e.y=(e.y??0)+(e._vy??0),(e.x<10||e.x>P.width-10)&&(e._vx=-(e._vx??0)),(e.y<10||e.y>P.height-10)&&(e._vy=-(e._vy??0)),e.x=Math.max(10,Math.min(P.width-10,e.x)),e.y=Math.max(10,Math.min(P.height-10,e.y)),b({[f]:{[t]:e}})})}(),function(){const t=p(!0);if(!t)return;let e=!1;k.ArrowUp&&(t.y=(t.y??0)-4,e=!0),k.ArrowDown&&(t.y=(t.y??0)+4,e=!0),k.ArrowLeft&&(t.x=(t.x??0)-4,e=!0),k.ArrowRight&&(t.x=(t.x??0)+4,e=!0),t.x=Math.max(20,Math.min(P.width-20,t.x??0)),t.y=Math.max(20,Math.min(P.height-20,t.y??0));const n=m();n[f]&&Object.entries(n[f]).forEach(([e,n])=>{var o,a,i,r;n&&(o=t.x??0,a=t.y??0,i=n.x??0,r=n.y??0,Math.sqrt((o-i)**2+(a-r)**2)<20&&(b({[f]:{[e]:null}}),x++,t.score=x,S.textContent=`Mice Caught: ${x}`))}),(e||void 0!==t.score)&&w(t)}(),function(){C.clearRect(0,0,P.width,P.height),C.fillStyle="#2d1810",C.fillRect(0,0,P.width,P.height),C.fillStyle="#1a0f0a";for(let a=0;a<8;a++){const t=P.width/8*a,e=P.height-30;C.fillRect(t-5,e,10,30),C.beginPath(),C.arc(t,e-10,15,0,2*Math.PI),C.fill()}const t=P.width-50,e=C.createRadialGradient(t-8,42,4,t,50,20);e.addColorStop(0,"#ffffff"),e.addColorStop(.55,"#f0f0f0"),e.addColorStop(1,"#d8d8d8"),C.save(),C.beginPath(),C.arc(t,50,20,0,2*Math.PI),C.fillStyle=e,C.fill(),C.clip(),[{dx:-6,dy:-2,r:4},{dx:3,dy:2,r:3},{dx:-2,dy:6,r:2.5},{dx:6,dy:-4,r:2},{dx:0,dy:-7,r:1.8}].forEach(e=>{C.globalAlpha=.28,C.fillStyle="#bdbdbd",C.beginPath(),C.arc(t+e.dx,50+e.dy,e.r,0,2*Math.PI),C.fill(),C.globalAlpha=.18,C.strokeStyle="#ffffff",C.lineWidth=1,C.beginPath(),C.arc(t+e.dx-.2*e.r,50+e.dy-.2*e.r,.75*e.r,0,2*Math.PI),C.stroke()});const n=C.createRadialGradient(t+10,54,4,t+18,60,23);n.addColorStop(0,"rgba(0,0,0,0)"),n.addColorStop(1,"rgba(0,0,0,0.25)"),C.fillStyle=n,C.globalAlpha=1,C.beginPath(),C.arc(t,50,20,0,2*Math.PI),C.fill(),C.restore();const o=m();if(o[f]&&Object.values(o[f]).forEach(t=>{var e,n;t&&(e=t.x??0,n=t.y??0,C.save(),C.translate(e,n),C.fillStyle="#808080",C.beginPath(),C.ellipse(0,0,6,4,0,0,2*Math.PI),C.fill(),C.beginPath(),C.arc(0,-4,4,0,2*Math.PI),C.fill(),C.fillStyle="#a0a0a0",C.beginPath(),C.arc(-2,-6,2,0,2*Math.PI),C.fill(),C.beginPath(),C.arc(2,-6,2,0,2*Math.PI),C.fill(),C.fillStyle="#ff0000",C.beginPath(),C.arc(-1,-5,1,0,2*Math.PI),C.fill(),C.beginPath(),C.arc(1,-5,1,0,2*Math.PI),C.fill(),C.strokeStyle="#808080",C.lineWidth=2,C.beginPath(),C.moveTo(6,0),C.lineTo(12,-2),C.stroke(),C.restore())}),o[l])for(const a in o[l]){const t=o[l][a];if(!t)continue;const e=a===u();N(t.x??0,t.y??0,e,t.score??0,t.name??"")}}(),requestAnimationFrame(t)}();
