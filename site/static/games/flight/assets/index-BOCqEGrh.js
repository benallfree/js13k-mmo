import{PartySocket as e}from"https://js13kgames.com/2025/online/partysocket.js";import*as t from"https://esm.sh/three";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),window.PartySocket=e,window.THREE=t;const n=(e,t,n=window.socket)=>{n.addEventListener("message",n=>{const o=n.data.toString();o.startsWith(e)&&t(o.slice(e.length))})},o=(e,t=window.socket)=>{t.send(e)},r=(e,t,n=window.socket)=>{o(`${e}${t}`,n)},s=(e,t=window.socket)=>{n("+",e,t)},a=(e,t=window.socket)=>{n("-",e,t)},i=(e,t=window.socket)=>{n("@",e,t)},c=i,d=e=>`_${e}`;function l(e,t,n=!1){const o={};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r],a=e[r];if(null===s)n?(delete e[r],o[r]=void 0):(e[r]=null,o[r]=null);else if(s&&"object"==typeof s&&!Array.isArray(s)&&a&&"object"==typeof a&&!Array.isArray(a)){const e=l(a,s,n);Object.keys(e).length>0&&(o[r]=e)}else s!==a&&(e[r]=s,o[r]=s)}return o}const w=e=>JSON.parse(JSON.stringify(e)),E=(e,t=0)=>0===t?Math.round(e):Math.round(e*Math.pow(10,t))/Math.pow(10,t),y=(e,t=0)=>{if("object"!=typeof e||null===e)return e;for(const n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;const o=e[n];"x"===n||"y"===n||"z"===n?"number"==typeof o&&(e[n]=E(o,t)):"object"==typeof o&&null!==o&&y(o,t)}return e},h=e=>{const t=2*Math.PI;return(e%=t)<0&&(e+=t),e},p=(e,t=2)=>{if("object"!=typeof e||null===e)return e;const n=e=>0===t?Math.round(e):Math.round(e*Math.pow(10,t))/Math.pow(10,t);for(const o in e){if(!Object.prototype.hasOwnProperty.call(e,o))continue;const r=e[o];"rx"===o||"ry"===o||"rz"===o?"number"==typeof r&&(e[o]=n(h(r))):"object"==typeof r&&null!==r&&p(r,t)}return e},u=e=>{const{socket:t=window.socket}={};let n=null;return i(e=>{n=e},t),{getMyId:()=>n}},M=document.createElement("div");M.className="status-indicator status-connecting",M.textContent="Connecting...",document.body.appendChild(M),(()=>{const e="mewsterpiece/flight".split("/"),{host:t="relay.js13kgames.com",global:n=!0}={},o=new window.PartySocket({host:t,party:e[0],room:e.join("/")});n&&(window.socket=o)})();const{getMyId:m}=u(),f=(H=m,(e,t)=>{const n=H();return n?{...t,_players:{...t._players,[n]:e?._players?.[n]||{}}}:t});var H;const{getState:R,getMyState:T,updateMyState:b}=(e=>{const{onBeforeSendState:t=e=>e,onStateReceived:i=(e,t)=>t,onDeltaReceived:c=e=>e,onBeforeSendDelta:E=e=>e,socket:y=window.socket,deltaThrottleMs:h=50}=e||{};let p={_players:{}};s(e=>{M(e)},y),a(e=>{T(e,null)},y);const M=e=>{const n=t(w(p));((e,t,n,r=window.socket)=>{((e,t,n=window.socket)=>{o(`@${e}|${t}`,n)})(e,`${t}${n}`,r)})(e,d("s"),JSON.stringify(n),y)};let m=null,f=null;const H=(e=window.socket)=>{if(!f||0===Object.keys(f).length||m)return;const t=E(w(f));r(d("d"),JSON.stringify(t),e),f=null,m=setTimeout(()=>{m=null,H(e)},h)},{getMyId:R}=u();((e,t=window.socket)=>{n(d("s"),t=>{const n=JSON.parse(t);e(n)},t)})(e=>{const t=i(p,e),n=l(p,t,!0);r(d("d"),JSON.stringify(n),y)},y),((e,t=window.socket)=>{n(d("d"),t=>{const n=JSON.parse(t);e(n)},t)})(e=>{const t=c(e);l(p,t)},y);const T=(e,t)=>{p._players[e]||(p._players[e]={});const n=l(p,{_players:{[e]:t}},!0);f||(f={}),l(f,n),H(y)};return{getState:(e=!1)=>e?w(p):p,getMyState:(e=!1)=>{const t=R();return t?((e,t=!1)=>t?w(p._players[e]||{}):p._players[e]||{})(t,e):null},updateMyState:e=>{const t=R();t&&T(t,e)},updatePlayerState:T}})({onBeforeSendDelta:e=>{const t=m();return t&&e?._players?.[t]?.s&&(e._players[t].s=E(e._players[t].s,2)),y(p(e))},onStateReceived:(e,t)=>f(e,t)});let g={};const x=new THREE.Scene,P=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),L=new THREE.WebGLRenderer({antialias:!1});L.setSize(window.innerWidth,window.innerHeight),L.setClearColor(8900331),document.body.appendChild(L.domElement);const S=new THREE.AmbientLight(4210752,.6);x.add(S);const k=new THREE.DirectionalLight(16777215,.8);k.position.set(100,100,50),x.add(k);const z=new THREE.PlaneGeometry(5e3,5e3),I=new THREE.MeshLambertMaterial({color:9498256}),O=new THREE.Mesh(z,I);O.rotation.x=-Math.PI/2,x.add(O),function(){const e=new THREE.PlaneGeometry(200,20),t=new THREE.MeshLambertMaterial({color:3355443}),n=new THREE.Mesh(e,t);n.rotation.x=-Math.PI/2,n.position.set(0,.1,0),x.add(n);for(let p=-8;p<=8;p+=2){const e=new THREE.PlaneGeometry(2,15),t=new THREE.MeshLambertMaterial({color:16777215}),n=new THREE.Mesh(e,t);n.rotation.x=-Math.PI/2,n.position.set(10*p,.2,0),x.add(n)}const o=new THREE.CylinderGeometry(5,8,30,8),r=new THREE.MeshLambertMaterial({color:6710886}),s=new THREE.Mesh(o,r);s.position.set(50,15,50),x.add(s);const a=new THREE.BoxGeometry(12,4,12),i=new THREE.MeshLambertMaterial({color:4473924}),c=new THREE.Mesh(a,i);c.position.set(50,32,50),x.add(c);for(let p=0;p<5;p++){const e=new THREE.ConeGeometry(100+50*Math.random(),200+100*Math.random(),6),t=new THREE.MeshLambertMaterial({color:9127187}),n=new THREE.Mesh(e,t);n.position.set(2e3*(Math.random()-.5),100+100*Math.random(),2e3*(Math.random()-.5)),x.add(n)}for(let p=0;p<8;p++){const e=new THREE.CylinderGeometry(2,3,20,8),t=new THREE.MeshLambertMaterial({color:8947848}),n=new THREE.Mesh(e,t);n.position.set(1e3*(Math.random()-.5),10,1e3*(Math.random()-.5)),x.add(n);const o=new THREE.BoxGeometry(40,2,4),r=new THREE.MeshLambertMaterial({color:13421772});for(let s=0;s<3;s++){const e=new THREE.Mesh(o,r);e.position.copy(n.position),e.position.y+=20,e.rotation.y=s*Math.PI*2/3,x.add(e)}}const d=new THREE.CylinderGeometry(8,8,25,8),l=new THREE.MeshLambertMaterial({color:8900331}),w=new THREE.Mesh(d,l);w.position.set(-100,12.5,-100),x.add(w);const E=new THREE.SphereGeometry(10,8,6),y=new THREE.MeshLambertMaterial({color:8900331}),h=new THREE.Mesh(E,y);h.position.set(-100,35,-100),x.add(h)}();const j=[16711680,65280,255,16776960,16711935,65535,16753920,8388736];function v(e=16711680){const t=new THREE.Group;t.rotation.z=-Math.PI/2;const n=new THREE.CylinderGeometry(1,2,8,8),o=new THREE.MeshLambertMaterial({color:e}),r=new THREE.Mesh(n,o);r.rotation.x=Math.PI/2,t.add(r);const s=new THREE.BoxGeometry(12,.5,3),a=new THREE.MeshLambertMaterial({color:e}),i=new THREE.Mesh(s,a);i.rotation.z=Math.PI/2,t.add(i);const c=new THREE.BoxGeometry(.5,4,2),d=new THREE.MeshLambertMaterial({color:e}),l=new THREE.Mesh(c,d);return l.position.set(-3,0,0),l.rotation.z=Math.PI/2,t.add(l),t}const C={},G=document.querySelector(".hud");document.addEventListener("keydown",e=>{g[e.code]=!0}),document.addEventListener("keyup",e=>{g[e.code]=!1}),((e,t=window.socket)=>{t.addEventListener("open",e)})(()=>{M.className="status-indicator status-connected",M.textContent="Connected"}),((e,t=window.socket)=>{t.addEventListener("close",e)})(()=>{M.className="status-indicator status-disconnected",M.textContent="Disconnected"}),c(e=>{const t=v(j[parseInt(e)%j.length]);t.position.set(0,50,0),x.add(t),C[e]=t;const n={x:0,y:50,z:0,rx:0,ry:0,rz:-Math.PI/2,s:0};b(n)}),s(e=>{}),a(e=>{C[e]&&e!==m()&&(x.remove(C[e]),delete C[e])}),window.addEventListener("resize",()=>{P.aspect=window.innerWidth/window.innerHeight,P.updateProjectionMatrix(),L.setSize(window.innerWidth,window.innerHeight)}),function e(){requestAnimationFrame(e),function(){const e=T(!0);if(!e)return;let t=!1;(g.KeyW||g.ArrowUp)&&(e.s=Math.min(200,(e.s||0)+2),t=!0),(g.KeyS||g.ArrowDown)&&(e.s=Math.max(0,(e.s||0)-2),t=!0),g.KeyA||g.ArrowLeft?(e.ry=(e.ry||0)+.02,e.rz=Math.max(-Math.PI/2-.3,(e.rz||0)-.02),t=!0):g.KeyD||g.ArrowRight?(e.ry=(e.ry||0)-.02,e.rz=Math.min(-Math.PI/2+.3,(e.rz||0)+.02),t=!0):e.rz=(e.rz||0)+.05*(-Math.PI/2-(e.rz||0)),g.KeyQ?(e.rx=Math.min(.3,(e.rx||0)+.02),t=!0):g.KeyE?(e.rx=Math.max(-.3,(e.rx||0)-.02),t=!0):e.rx=.95*(e.rx||0);const n=new THREE.Vector3(0,0,e.s),o=new THREE.Euler(e.rx,e.ry,e.rz);n.applyEuler(o),e.x=(e.x||0)+.016*n.x,e.y=(e.y||0)+.016*n.y,e.z=(e.z||0)+.016*n.z,e.y=Math.max(2,e.y),e.s=.98*(e.s||0),(t||(e.s||0)>.1)&&b(e)}(),function(){const e=R();if(e._players)for(const t in e._players){const n=e._players[t];if(!n)continue;if(!C[t]){const e=j[parseInt(t)%j.length];C[t]=v(e),x.add(C[t])}const o=C[t];o.position.set(n.x||0,n.y||0,n.z||0),o.rotation.set(n.rx||0,n.ry||0,n.rz||0),o.userData.speed=n.s||0}}(),function(){const e=T();if(!e)return;const t=new THREE.Vector3(e.x,e.y,e.z),n=new THREE.Euler(e.rx,e.ry,e.rz),o=new THREE.Vector3(0,15,-40);o.applyEuler(n),P.position.copy(t).add(o),P.lookAt(t)}(),function(){const e=T();e&&G&&(G.innerHTML=`\n    ALT: ${Math.max(0,Math.round(e.y||0))}m<br>\n    SPD: ${Math.round(e.s||0)}<br>\n    HDG: ${Math.round(((e.ry||0)/Math.PI+360)%360)}°<br>\n    PITCH: ${Math.round((e.rx||0)/Math.PI)}°<br>\n    ROLL: ${Math.round((e.rz||0)/Math.PI)}°\n  `)}(),L.render(x,P)}();
