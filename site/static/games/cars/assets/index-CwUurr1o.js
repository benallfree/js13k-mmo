import{PartySocket as t}from"https://js13kgames.com/2025/online/partysocket.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}(),window.PartySocket=t;const e=(t,e,n=window.socket)=>{n.addEventListener("message",n=>{const o=n.data.toString();o.startsWith(t)&&e(o.slice(t.length))})},n=(t,e=window.socket)=>{e.send(t)},o=(t,e,o=window.socket)=>{n(`${t}${e}`,o)},r=(t,n=window.socket)=>{e("@",t,n)},s=r,i=t=>`_${t}`;function c(t,e,n=!1){const o={};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const s=e[r],i=t[r];if(null===s)n?(delete t[r],o[r]=void 0):(t[r]=null,o[r]=null);else if(s&&"object"==typeof s&&!Array.isArray(s)&&i&&"object"==typeof i&&!Array.isArray(i)){const t=c(i,s,n);Object.keys(t).length>0&&(o[r]=t)}else s!==i&&(t[r]=s,o[r]=s)}return o}const l=t=>JSON.parse(JSON.stringify(t)),a=(t,e=0)=>{if("object"!=typeof t||null===t)return t;const n=t=>0===e?Math.round(t):Math.round(t*Math.pow(10,e))/Math.pow(10,e);for(const o in t){if(!Object.prototype.hasOwnProperty.call(t,o))continue;const r=t[o];"x"===o||"y"===o||"z"===o?"number"==typeof r&&(t[o]=n(r)):"object"==typeof r&&null!==r&&a(r,e)}return t},d=(t,e=2)=>{if("object"!=typeof t||null===t)return t;const n=t=>0===e?Math.round(t):Math.round(t*Math.pow(10,e))/Math.pow(10,e),o=t=>{const e=2*Math.PI;return(t%=e)<0&&(t+=e),t};for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const s=t[r];"rx"===r||"ry"===r||"rz"===r?"number"==typeof s&&(t[r]=n(o(s))):"object"==typeof s&&null!==s&&d(s,e)}return t},f=t=>{const{socket:e=window.socket}={};let n=null;return r(t=>{n=t},e),{getMyId:()=>n}};window.socket=new window.PartySocket({host:"relay.js13kgames.com",party:"mewsterpiece",room:"cars"});const{getState:y,getMyState:u,updateMyState:w,updatePlayerState:p}=(t=>{const{onBeforeSendState:r=t=>t,onStateReceived:s=(t,e)=>e,onDeltaReceived:a=t=>t,onBeforeSendDelta:d=t=>t,socket:y=window.socket,deltaThrottleMs:u=50}=t||{};let w={_players:{}};((t,n=window.socket)=>{e("+",t,n)})(t=>{p(t)},y);const p=t=>{const e=r(l(w));((t,e,o,r=window.socket)=>{((t,e,o=window.socket)=>{n(`@${t}|${e}`,o)})(t,`${e}${o}`,r)})(t,i("s"),JSON.stringify(e),y)};let h=null,g=null;const m=(t=window.socket)=>{if(!g||0===Object.keys(g).length||h)return;const e=d(l(g));o(i("d"),JSON.stringify(e),t),g=null,h=setTimeout(()=>{h=null,m(t)},u)},{getMyId:k}=f();((t,n=window.socket)=>{e(i("s"),e=>{const n=JSON.parse(e);t(n)},n)})(t=>{const e=s(w,t),n=c(w,e,!0);o(i("d"),JSON.stringify(n),y)},y),((t,n=window.socket)=>{e(i("d"),e=>{const n=JSON.parse(e);t(n)},n)})(t=>{const e=a(t);c(w,e)},y);const S=(t,e)=>{w._players[t]||(w._players[t]={});const n=c(w,{_players:{[t]:e}},!0);g||(g={}),c(g,n),m(y)};return{getState:(t=!1)=>t?l(w):w,getMyState:(t=!1)=>{const e=k();return e?((t,e=!1)=>e?l(w._players[t]||{}):w._players[t]||{})(e,t):null},updateMyState:t=>{const e=k();e&&S(e,t)},updatePlayerState:S}})({onStateReceived:(t,e)=>{const n=h();return n&&(e._players[n]=t._players[n]),e},onBeforeSendDelta:t=>a(d(t)),onDeltaReceived:t=>t});((t,n=window.socket)=>{e("-",t,n)})(t=>{p(t,null)});const{getMyId:h}=f(),g=document.createElement("div");g.className="status-indicator status-connecting",g.textContent="Connecting...",document.body.appendChild(g);let m={ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1};const k=document.getElementById("gameCanvas"),S=k.getContext("2d");function M(){const t=k.parentElement;k.width=t.clientWidth,k.height=t.clientHeight}M(),window.addEventListener("resize",M);const v=["#ff0000","#000000","#0000ff","#ffff00","#ff00ff","#00ffff","#ffa500","#800080"];function O(t,e,n,o,r=!1){S.save(),S.translate(t,e),S.rotate(n),S.fillStyle=o,S.fillRect(-15,-8,30,16),S.fillRect(-8,-12,16,8),S.fillStyle="#333",S.fillRect(-12,-10,4,20),S.fillRect(8,-10,4,20),S.fillStyle="#ffff00",S.fillRect(-12,-6,3,3),S.fillRect(-12,3,3,3),r&&(S.fillStyle="#fff",S.font="12px Arial",S.textAlign="center",S.fillText("YOU",0,-20)),S.restore()}((t,e=window.socket)=>{e.addEventListener("open",t)})(()=>{g.className="status-indicator status-connected",g.textContent="Connected"}),((t,e=window.socket)=>{e.addEventListener("close",t)})(()=>{g.className="status-indicator status-disconnected",g.textContent="Disconnected"}),s(t=>{const e={x:k.width/2,y:k.height/2,rz:0};w(e)}),document.addEventListener("keydown",t=>{m.hasOwnProperty(t.key)&&(m[t.key]=!0,t.preventDefault())}),document.addEventListener("keyup",t=>{m.hasOwnProperty(t.key)&&(m[t.key]=!1,t.preventDefault())}),function t(){!function(){const t=u(!0);if(!t)return;let e=!1;m.ArrowUp&&(t.x-=3*Math.cos(t.rz),t.y-=3*Math.sin(t.rz),e=!0),m.ArrowDown&&(t.x+=2*Math.cos(t.rz),t.y+=2*Math.sin(t.rz),e=!0),m.ArrowLeft&&(t.rz-=.1,e=!0),m.ArrowRight&&(t.rz+=.1,e=!0),t.x=Math.max(20,Math.min(k.width-20,t.x)),t.y=Math.max(20,Math.min(k.height-20,t.y)),e&&w(t)}(),function(){S.clearRect(0,0,k.width,k.height),S.fillStyle="#1c5e1e",S.fillRect(0,0,k.width,k.height),S.strokeStyle="#fff",S.lineWidth=2,S.setLineDash([20,20]),S.beginPath(),S.moveTo(k.width/2,0),S.lineTo(k.width/2,k.height),S.stroke(),S.setLineDash([]);const t=y();if(t._players)for(const e in t._players){const n=t._players[e],o=Array.from(String(e)).reduce((t,e)=>t+e.charCodeAt(0),0)%v.length,r=v[o],s=e===h();O(n.x,n.y,n.rz,r,s)}}(),requestAnimationFrame(t)}();const b=document.getElementById("helpBtn"),A=document.querySelector(".instructions");b&&A&&b.addEventListener("click",()=>{const t=A.classList.toggle("visible");b.classList.toggle("active",t)});
